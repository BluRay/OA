AP.widget.Record=new AP.Class({initialize:function(a){for(var b in a.dom){this[b]=D.get(a.dom[b])}},initXBox:function(a){new AP.widget.xBox({el:D.query(".js-xbox"),type:"iframe",value:function(b){return b.href},modal:true,hasHead:false,fixed:false,autoFitPosition:true})},initKeywordTips:function(){var a=this;E.on(a.keyword,"keyup",function(b){if(this.value==this.getAttribute("data-tips")){D.addClass(this,"ft-gray");a.keywordType.options[this.getAttribute("rel-option")].setAttribute("old-data","")}else{D.removeClass(this,"ft-gray")}});E.on(a.keyword,"blur",function(c){var b;if(this.value==this.getAttribute("data-tips")){D.addClass(this,"ft-gray")}else{if(this.value==""){b=this.value;this.value=this.getAttribute("data-tips")||"";D.addClass(this,"ft-gray")}else{b=this.value;D.removeClass(this,"ft-gray")}}if(a.keywordType){if(this.getAttribute("rel-option")&&typeof b!="undefined"&&this.getAttribute("rel-option")){a.keywordType.options[this.getAttribute("rel-option")].setAttribute("old-data",b)}}});E.on(a.keyword,"focus",function(b){if(this.value==this.getAttribute("data-tips")){this.value=""}})},initSelectDataTips:function(){var a=this;E.on(a.keywordType,"change",function(c){var e=E.getTarget(c);var b=e.options[e.selectedIndex];var d=b.getAttribute("data-tips");if(b.getAttribute("old-data")){a.keyword.value=b.getAttribute("old-data");a.keyword.select();D.removeClass(a.keyword,"ft-gray")}else{a.keyword.setAttribute("data-tips",d);a.keyword.value=d;D.addClass(a.keyword,"ft-gray")}a.keyword.setAttribute("rel-option",e.selectedIndex)})},initToPage:function(){var a=this;E.on(D.query(".form-element"),"click",function(f){var c=E.getTarget(f);var b=c.getAttribute("rel");var d=c.getAttribute("rel-value").trim();a.queryForm[b].value=d;formFreeFlag=true;submitQueryForm();E.preventDefault(f)})},initTabCard:function(){var a=this;var b=D.query("#J-table-consume .ui-tab-trigger-item a");E.on(b,"click",function(c){E.preventDefault(c);a.queryForm.currentPageNo.value=1;a.queryForm.currentTab.value=this.getAttribute("data");formFreeFlag=true;submitQueryForm()})},initCalendar:function(b){var c=function(){var f=[];for(var e=1;e<=12;e++){f.push(e)}if(typeof b=="undefined"){var d=new Date()}else{var d=new Date(b)}return f[d.getMonth()]+"/"+d.getDate()+"/"+d.getFullYear()};var a=new AP.widget.calendar("calendar","calendarContainer",{maxdate:c(),show_dropfilter:true,dropfilter:{startYear:"2004",endYear:new Date(D.get("J-date-today").value).getFullYear()},matchDate:{today:D.get("J-date-today").value,date:[[1,"d","J-today"],[7,"d","J-seven-day"],[30,"d","J-a-month"],[90,"d","J-three-month"]]}},[D.query(".i-date")])},initBizTypeCombo:function(){var a=this;E.on("J-consume-place","click",function(c){var b=E.getTarget(c);if(b.tagName.toUpperCase()=="A"){if(b.getAttribute("data")!=a.queryForm.consumePlace.value){a.queryForm.keyword.value=a.searchForm.keyword.value=""}D.get("J-keyword-type").options[0].selected=1;setKeyword();if(checkTimeStatus&&!checkTimeStatus()){return false}a.queryForm.consumePlace.value=b.getAttribute("data");a.queryForm.inOut.value="";a.queryForm.timeType.value="1";a.queryForm.payType.value="";a.queryForm.bizSubType.value="";a.queryForm.currentPageNo.value="1";formFreeFlag=true;submitQueryForm()}E.preventDefault(c)})},setBizType:function(){var a=this;E.on("J-consume-place-more","click",function(d){var c=E.getTarget(d);var b=D.get("J-consume-place");if(a.queryForm.consumePlaceOpen.value=="true"){a.queryForm.consumePlaceOpen.value="false";D.addClass(b,"blue-links-min");D.removeClass(this,"ui-btn-white-mini-little");D.addClass(this,"ui-btn-white-mini-more");this.innerHTML="其它"}else{a.queryForm.consumePlaceOpen.value="true";D.removeClass(b,"blue-links-min");D.addClass(this,"ui-btn-white-mini-little");D.removeClass(this,"ui-btn-white-mini-more");this.innerHTML="收起"}setTimeout(function(){D.setStyles(D.query(".record-search-time"),{position:"static"});D.setStyles(D.query(".record-search-option"),{position:"static"});D.setStyles(D.query(".record-search-submit"),{position:"static"});D.setStyles(D.query(".submit-time"),{position:"static"});D.setStyles(D.query(".record-search-time"),{position:"relative",top:0})},1)});this.setAdvancedOption(a.queryForm.consumePlace.value)},setAdvancedOption:function(h){var b=D.get("J-keyword-type-select"),g=[],a;if(typeof bizTypeList["type"+h]=="undefined"){a=bizTypeList.normal}else{a=bizTypeList["type"+h]}var c;for(var f=0;f<=a.key.length-1;f++){c="";if(typeof a.key[f].dataTips=="undefined"){a.key[f].dataTips=""}if(typeof a.key[f].selected=="undefined"){a.key[f].selected="0"}if(a.key[f].selected=="1"){this.keyword.setAttribute("data-tips",a.key[f].dataTips);this.keyword.setAttribute("rel-option",f);this.keyword.value=a.key[f].dataTips;D.addClass(this.keyword,"ft-gray");c=" selected "}g.push('<option value="'+a.key[f].value+'" '+c+' data-tips="'+a.key[f].dataTips+'" '+(typeof a.key[f].seed!="undefined"?('seed="'+a.key[f].seed+'"'):"")+" >"+a.key[f].label+"</option>")}b.innerHTML='<select name="keyword-type" id="'+this.keywordType.id+'">'+g.join("")+"</select>";var k=[];var d=[];for(var f=0;f<=a.opt.length-1;f++){if(f==0){if(a.opt[f].type=="checkbox"||a.opt[f].type=="radio"){k.push('<div class="ui-form-item ui-form-item-sel"><label class="ui-form-label">'+a.opt[f].label+'：</label><div class="ui-form-item-content">');for(var e=0;e<=a.opt[f].list.length-1;e++){k.push('<input class="form-d-element" type="'+a.opt[f].type+'" '+(typeof a.opt[f].list[e].seed!="undefined"?(' seed="'+a.opt[f].list[e].seed+'" '):"")+' name="'+a.opt[f].name+'" '+(a.opt[f].list[e].checked==1?" checked ":"")+' value="'+a.opt[f].list[e].value+'" id="'+a.opt[f].list[e].id+'" /> <label for="'+a.opt[f].list[e].id+'"" class="ui-form-label-desc" >'+a.opt[f].list[e].label+"</label>")}k.push("</div></div>")}}else{if(a.opt[f].type=="checkbox"||a.opt[f].type=="radio"){d.push('<div class="ui-form-item ui-form-item-sel"><label class="ui-form-label">'+a.opt[f].label+'：</label><div class="ui-form-item-content">');for(var e=0;e<=a.opt[f].list.length-1;e++){d.push('<input class="form-d-element" type="'+a.opt[f].type+'" '+(typeof a.opt[f].list[e].seed!="undefined"?(' seed="'+a.opt[f].list[e].seed+'" '):"")+' name="'+a.opt[f].name+'" '+(a.opt[f].list[e].checked==1?" checked ":"")+' value="'+a.opt[f].list[e].value+'" id="'+a.opt[f].list[e].id+'" /> <label for="'+a.opt[f].list[e].id+'"" class="ui-form-label-desc" >'+a.opt[f].list[e].label+"</label>")}d.push("</div></div>")}}}D.get("J-filter-condition-left").innerHTML=k.join("");D.get("J-filter-condition-right").innerHTML=d.join("");this.keywordType=D.get(this.keywordType.id);this.initSelectDataTips()},switchFilter:function(b){var c=E.getTarget(b);var a=D.get("J-filter");if(a.value*1==1){a.value=2;c.innerHTML="收起";D.addClass(c,"ui-btn-white-mini-little");D.removeClass(D.query(".record-search-option-keyword"),"fn-hide");D.removeClass("J-filter-condition-right","fn-hide");D.removeClass("J-submit-form","fn-hide");D.addClass(D.query(".submit-time-container"),"fn-hide");D.addClass(D.query(".quick-link-date"),"quick-link-date-disabled");D.removeClass(D.query(".quick-link-date"),"blue-links");D.addClass("J-advanced-filter-option","ui-bg-yellow")}else{a.value=1;c.innerHTML="更多选项";D.removeClass(c,"ui-btn-white-mini-little");D.addClass(D.query(".record-search-option-keyword"),"fn-hide");D.addClass("J-filter-condition-right","fn-hide");D.addClass("J-submit-form","fn-hide");D.removeClass(D.query(".submit-time-container"),"fn-hide");D.removeClass(D.query(".quick-link-date"),"quick-link-date-disabled");D.addClass(D.query(".quick-link-date"),"blue-links");D.removeClass("J-advanced-filter-option","ui-bg-yellow")}E.preventDefault(b)},initFormStatus:function(){var f=this;if(D.get("J-date-today").value.replace(/\//g,"")==D.get("J-end").value.replace(/\./g,"")){var a=new Date(D.get("J-start").value.replace(/\./g,"/"));var e=new Date(D.get("J-end").value.replace(/\./g,"/"));var d=(e-a)/86400000;var g="";if(d==0){g="J-today"}else{if(d==6){g="J-seven-day"}else{if(d==29){g="J-a-month"}else{if(d==89){g="J-three-month"}}}}D.addClass(g,"active")}var c=[];var b=f.queryForm.keyword.value;var i=b.indexOf("_");c[0]=b.substring(0,i);if(i!=-1){c[1]=b.substring(i+1,b.length)}(function(){var r={};var m=function(w){var u;if(w instanceof Array){u=[];var v=w.length;while(v--){u[v]=m(w[v])}return u}else{if(w instanceof Object){u={};for(var j in w){u[j]=m(w[j])}return u}else{return w}}};if(typeof bizTypeList["type"+f.queryForm.consumePlace.value]=="undefined"){r.normal=m(bizTypeList.normal)}else{r["type"+f.queryForm.consumePlace.value]=m(bizTypeList["type"+f.queryForm.consumePlace.value])}var l,o;var s=c[0]-1;if(typeof bizTypeList["type"+f.queryForm.consumePlace.value]=="undefined"){l=bizTypeList.normal.key;o=bizTypeList.normal.opt}else{l=bizTypeList["type"+f.queryForm.consumePlace.value].key;o=bizTypeList["type"+f.queryForm.consumePlace.value].opt}for(var n=0,p=l.length-1;n<=p;n++){if(s==n){l[n].selected="1"}else{l[n].selected="0"}}for(var n=0,p=o.length-1;n<=p;n++){var t=f.queryForm[o[n].name].value.split("_");if(t.length==0){break}for(var k=0,q=o[n].list.length-1;k<=q;k++){if(t.indexOf(o[n].list[k].value)!=-1){o[n].list[k].checked=1}else{o[n].list[k].checked=0}}}f.setBizType(D.get("type"+f.queryForm.consumePlace.value));if(typeof bizTypeList["type"+f.queryForm.consumePlace.value]=="undefined"){bizTypeList.normal=r.normal}else{bizTypeList["type"+f.queryForm.consumePlace.value]=r["type"+f.queryForm.consumePlace.value]}})();if(c[1]!=""&&c[1]!=undefined){this.keyword.value=c[1];this.keywordType.options[c[0]-1].setAttribute("old-data",c[1])}else{var h=this.keywordType.options[this.keywordType.selectedIndex].getAttribute("data-tips");if(h&&h!=""){this.keyword.value=h;this.keyword.setAttribute("data-tips",h);D.addClass(this.keyword,"ft-gray")}}},showStatInfo:function(d){var b=E.getTarget(d);b.style.cursor="wait";var a=function(){if(b.getAttribute("data-show-status")==0){b.setAttribute("data-show-status",1);D.removeClass("J-stat-info","fn-hide");D.removeClass(D.query(".stat-info-cash-out"),"fn-hide");D.removeClass(D.query(".stat-info-cash-in"),"fn-hide");D.addClass(b,"show-stat-info-selected")}else{b.setAttribute("data-show-status",0);D.addClass("J-stat-info","fn-hide");D.addClass(D.query(".stat-info-cash-out"),"fn-hide");D.addClass(D.query(".stat-info-cash-in"),"fn-hide");D.removeClass(b,"show-stat-info-selected")}};if(typeof amountData!="undefined"&&amountData!=""){a();b.style.cursor="pointer";return false}var c=new AP.core.ajax("/consume/record/statistic.json",{callback:{success:function(f){b.style.cursor="pointer";var f=L.JSON.parse(f.responseText);var e=D.get("J-stat-info");if(f.stat=="ok"){amountData=f.statisticVO;D.query(".outTotalCount",e)[0].innerHTML=amountData.outTotalCount;D.query(".outTotalAmount",e)[0].innerHTML=amountData.outTotalAmount;D.query(".successOutTotalCount",e)[0].innerHTML=amountData.successOutTotalCount;D.query(".successOutTotalAmount",e)[0].innerHTML=amountData.successOutTotalAmount;D.query(".inProcessOutTotalCount",e)[0].innerHTML=amountData.inProcessOutTotalCount;D.query(".inProcessOutTotalAmount",e)[0].innerHTML=amountData.inProcessOutTotalAmount;D.query(".inTotalCount",e)[0].innerHTML=amountData.inTotalCount;D.query(".inTotalAmount",e)[0].innerHTML=amountData.inTotalAmount;D.query(".successInTotalCount",e)[0].innerHTML=amountData.successInTotalCount;D.query(".successInTotalAmount",e)[0].innerHTML=amountData.successInTotalAmount;D.query(".inProcessInTotalCount",e)[0].innerHTML=amountData.inProcessInTotalCount;D.query(".inProcessInTotalAmount",e)[0].innerHTML=amountData.inProcessInTotalAmount;a()}else{if(f.stat=="fail"){var g=f.msg;D.query(".tip-angle-content",e)[0].innerHTML=g;D.removeClass(D.query(".t-error",e),"fn-hide");D.removeClass(e,"fn-hide");D.addClass(b,"show-stat-info-selected")}else{if(f.stat=="deny"){if(AP.core.callfromiframe){self.parent.location.reload()}else{location.href=f.target}}}}},failure:function(e){D.query(".tip-angle-content",countInfo)[0].innerHTML="查询失败";D.removeClass(D.query(".t-error",countInfo),"fn-hide");D.removeClass(countInfo,"fn-hide");D.addClass(b,"show-stat-info-selected");b.style.cursor="pointer"}},format:"JSON",method:"POST"});c.submit("queryForm");E.preventDefault(d)},popDealInfo:function(){E.on(D.query(".amount-pay"),"mouseover",function(c){var e=E.getTarget(c),a=e.parentNode,d=D.query(".amount-info",a),b=D.get("amount-info");if(d.length<=0){return false}D.query(".container",b)[0].innerHTML=d[0].innerHTML;var f=D.getXY(e);D.removeClass(b,"fn-hide");D.setStyles(b,{left:(f[0]+e.offsetWidth/2)-23+"px",top:(f[1]-b.offsetHeight-5)+"px"})});E.on(D.query(".amount-pay"),"mouseout",function(b){var a=D.get("amount-info");D.addClass(a,"fn-hide")})},orderTable:function(){var a=this;E.on(D.query(".ico-order"),"click",function(b){var c=E.getTarget(b);var d=a.queryForm.orderBy;if(d.value==1){d.value=2}else{d.value=1}a.queryForm.currentPageNo.value=1;formFreeFlag=true;submitQueryForm();E.preventDefault(b)})},setReset:function(){var b=this;var a=D.get("J-topSearchForm-reset");E.on(a,"click",function(h){E.preventDefault(h);var g=D.get("J-filter").value;b.searchForm.reset();D.get("J-filter").value=g;D.removeClass(D.get("J-today"),"active");D.removeClass(D.get("J-seven-day"),"active");D.removeClass(D.get("J-a-month"),"active");D.removeClass(D.get("J-three-month"),"active");if(b.queryForm.customerType.value==1){D.addClass(D.get("J-seven-day"),"active")}else{D.addClass(D.get("J-a-month"),"active")}var e=new Date(D.get("J-date-today").value);var d=e.getFullYear()+"."+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"."+(e.getDate()<10?"0":"")+e.getDate();var f=new Date(e.setDate(e.getDate()-(b.queryForm.customerType.value==1?6:29)));var c=f.getFullYear()+"."+(f.getMonth()<9?"0":"")+(f.getMonth()+1)+"."+(f.getDate()<10?"0":"")+f.getDate();D.get("J-start").value=c;D.get("J-end").value=d;b.setAdvancedOption(b.queryForm.consumePlace.value);return false})},setDate:function(){var a=this;var b=D.get("J-set-date");E.on(b,"click",function(h){var i=E.getTarget(h);var g=D.get("J-filter").value*1;var e=D.get("J-start"),d=D.get("J-end"),c=new Date(D.get("J-date-today").value),f=new Date(D.get("J-date-today").value);if(i.tagName.toUpperCase()=="A"){if(i.id=="J-one-year"){window.open(i.href);E.preventDefault(h);return false}D.removeClass(D.query("a",b),"active");D.addClass(i,"active");if(i.id=="J-today"){f.setDate(f.getDate()-1)}if(i.id=="J-seven-day"){f.setDate(f.getDate()-7)}if(i.id=="J-a-month"){f.setDate(f.getDate()-30)}if(i.id=="J-three-month"){f.setDate(f.getDate()-90)}f.setDate(f.getDate()+1);d.value=c.getFullYear()+"."+(c.getMonth()<9?"0":"")+(c.getMonth()+1)+"."+(c.getDate()<10?"0":"")+c.getDate();e.value=f.getFullYear()+"."+(f.getMonth()<9?"0":"")+(f.getMonth()+1)+"."+(f.getDate()<10?"0":"")+f.getDate();if(g==1){a.queryForm.beginTime.value=e.value.replace(/\./g,"-");a.queryForm.endTime.value=d.value.replace(/\./g,"-");a.queryForm.currentPageNo.value=1;formFreeFlag=true;submitQueryForm()}}E.preventDefault(h)})}});